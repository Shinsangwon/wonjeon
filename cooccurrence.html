<!-- 섹션 3: 한문 배열 비교 -->
<h2>3. 한문 배열 비교</h2>
<p class="hint">공백 및 한자 외 문자는 무시합니다. 두 문장의 한자 배열 순서와 동일성을 비교합니다.</p>

<div class="row">
  <label><strong>문장 A:</strong></label>
  <textarea id="input3a" class="box" placeholder="예: 生死有命 富貴在天"></textarea>
</div>
<div class="row">
  <label><strong>문장 B:</strong></label>
  <textarea id="input3b" class="box" placeholder="예: 死生有命 貴富在天"></textarea>
</div>

<div class="row">
  <label><input type="checkbox" id="ignoreVariants"> 간체/번체 차이 무시</label>
</div>

<div class="row" style="position: relative;">
  <label><strong>비교 결과:</strong></label>
  <div id="output3" class="out box mono"></div>
</div>

<style>
  .diff { background: #ffcdd2; }
  .stats { margin-top: 8px; font-size: .9rem; color: #333; }
</style>

<script>
  /* === 3) 한문 배열 비교 === */

  const input3a=document.getElementById('input3a');
  const input3b=document.getElementById('input3b');
  const output3=document.getElementById('output3');
  const ignoreVariants=document.getElementById('ignoreVariants');

  // OpenCC 변환기 (번체→간체)
  const toCN=OpenCC.Converter({from:"t",to:"cn"});

  function extractHanja(text){
    try {
      return (text.match(/\p{Script=Han}/gu) || []);
    } catch {
      return (text.match(/[\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF]/g) || []);
    }
  }

  function compareHanja(aText, bText){
    let aArr=extractHanja(aText);
    let bArr=extractHanja(bText);

    if(ignoreVariants.checked){
      aArr=aArr.map(ch=>toCN(ch));
      bArr=bArr.map(ch=>toCN(ch));
    }

    const n=aArr.length, m=bArr.length;

    // LCS 계산
    const dp=Array.from({length:n+1},()=>Array(m+1).fill(0));
    for(let i=n-1;i>=0;i--){
      for(let j=m-1;j>=0;j--){
        dp[i][j]=(aArr[i]===bArr[j])?dp[i+1][j+1]+1:Math.max(dp[i+1][j],dp[i][j+1]);
      }
    }

    // backtrack
    let i=0,j=0;
    let resA='',resB='';
    let lcsCount=0;
    while(i<n && j<m){
      if(aArr[i]===bArr[j]){
        resA+=escapeHTML(aArr[i]);
        resB+=escapeHTML(bArr[j]);
        i++; j++; lcsCount++;
      } else if(dp[i+1][j]>=dp[i][j+1]){
        resA+=`<span class="diff">${escapeHTML(aArr[i])}</span>`;
        i++;
      } else {
        resB+=`<span class="diff">${escapeHTML(bArr[j])}</span>`;
        j++;
      }
    }
    while(i<n){resA+=`<span class="diff">${escapeHTML(aArr[i])}</span>`;i++;}
    while(j<m){resB+=`<span class="diff">${escapeHTML(bArr[j])}</span>`;j++;}

    // 통계 계산
    const totalA=n, totalB=m;
    const maxLen=Math.max(n,m)||1;
    const sameRatio=(lcsCount/maxLen*100).toFixed(1);
    const diffCount=(totalA+totalB)-(2*lcsCount);

    const stats=`<div class="stats">
      문장 A 한자 수: ${totalA} | 문장 B 한자 수: ${totalB}<br>
      동일률: ${sameRatio}% | 다른 글자 수: ${diffCount}
    </div>`;

    return `<div><strong>A:</strong> ${resA}</div><div><strong>B:</strong> ${resB}</div>${stats}`;
  }

  function updateSection3(){
    const a=input3a.value||'';
    const b=input3b.value||'';
    output3.innerHTML=compareHanja(a,b);
  }

  input3a.addEventListener('input',updateSection3);
  input3b.addEventListener('input',updateSection3);
  ignoreVariants.addEventListener('change',updateSection3);
</script>
