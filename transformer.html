<!doctype html>
<html lang="ko">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>간체/번체 변환 · 구두점 변환 · 한문 배열 비교</title>

<!-- OpenCC-JS -->
<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>

<style>
  body { max-width: 960px; margin: 32px auto; padding: 0 16px; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK KR", "Apple SD Gothic Neo", sans-serif; }
  h1 { font-size: 1.6rem; margin-bottom: .5rem; }
  h2 { font-size: 1.3rem; margin-top: 2rem; }
  .row { margin: 10px 0; }
  select, button { font-size: 1rem; padding: 6px 10px; }
  .toolbar { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .hint { color: #666; font-size: .9rem; margin-top: 4px; }
  .box { border: 1px solid #ddd; background: #fff; box-sizing: border-box; width: 100%; }
  .editable, .out, textarea { min-height: 140px; padding: 10px; font-size: 1rem; line-height: 1.6; width: 100%; }
  .editable { outline: none; white-space: pre-wrap; }
  .out { background: #f7f7f8; white-space: pre-wrap; overflow-x: auto; position: relative; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  .changed { background: #fff59d; }
  .will-change { background: #e1f5fe; }

  /* 복사 아이콘 버튼 */
  .copy-btn {
    position: absolute;
    top: 6px; right: 6px;
    border: none;
    background: transparent;
    cursor: pointer;
    padding: 2px;
  }
  .copy-btn svg {
    width: 20px;
    height: 20px;
    fill: #555;
  }
  .copy-btn:hover svg {
    fill: #000;
  }

  /* 비교 강조 */
  .diff { background: #ffcdd2; color: #c62828; font-weight: bold; }
  .stats { margin-top: 8px; font-size: 1rem; color: #222; }
</style>

<h1>간체/번체 변환 · 구두점 변환 · 한문 배열 비교</h1>

<!-- 섹션 1: 간체/번체 변환 -->
<h2>1. 간체/번체 변환</h2>
<div class="row">
  <div class="toolbar">
    <label for="mode"><strong>변환 모드:</strong></label>
    <select id="mode">
      <option value="cn>t">간체 → 번체(표준)</option>
      <option value="t>cn">번체(표준) → 간체</option>
      <option value="cn>tw">간체 → 번체(대만)</option>
      <option value="cn>twp">간체 → 번체(대만·어휘)</option>
      <option value="cn>hk">간체 → 번체(홍콩)</option>
      <option value="tw>cn">번체(대만) → 간체</option>
      <option value="hk>cn">번체(홍콩) → 간체</option>
    </select>
    <button id="clear1">지우기</button>
  </div>
</div>

<div class="row">
  <label><strong>입력:</strong></label>
  <div id="input1" class="editable box mono" contenteditable="true" spellcheck="false"></div>
  <div id="count1" class="hint"></div>
</div>

<div class="row" style="position: relative;">
  <label><strong>출력:</strong></label>
  <div id="output1" class="out box mono"></div>
  <button id="copy1" class="copy-btn" title="복사">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
      <path d="M10 1.5v1h1a1 1 0 0 1 1 1V14a1 
      1 0 0 1-1 1H5a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1A.5.5 
      0 0 1 6.5 1h3a.5.5 0 0 1 .5.5z"/>
    </svg>
  </button>
</div>

<!-- 섹션 2: 구두점 변환 -->
<h2>2. 구두점 변환</h2>
<div class="row">
  <div class="toolbar">
    <button id="clear2">지우기</button>
  </div>
</div>

<div class="row">
  <label><strong>입력:</strong></label>
  <textarea id="input2" class="box" placeholder="예: 你好，世界。发展头发？"></textarea>
  <div id="count2" class="hint"></div>
</div>

<div class="row" style="position: relative;">
  <label><strong>출력:</strong></label>
  <textarea id="output2" class="out box" readonly></textarea>
  <button id="copy2" class="copy-btn" title="복사">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
      <path d="M10 1.5v1h1a1 1 0 0 1 1 1V14a1 
      1 0 0 1-1 1H5a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1A.5.5 
      0 0 1 6.5 1h3a.5.5 0 0 1 .5.5z"/>
    </svg>
  </button>
</div>

<!-- 섹션 3: 한문 배열 비교 -->
<h2>3. 한문 배열 비교</h2>
<p class="hint">공백 및 한자 외 문자는 무시합니다. 두 문장의 한자 배열 순서와 동일성을 비교합니다.</p>

<div class="row">
  <label><strong>문장 A:</strong></label>
  <div id="input3a" class="editable box mono" contenteditable="true" spellcheck="false"></div>
</div>
<div class="row">
  <label><strong>문장 B:</strong></label>
  <div id="input3b" class="editable box mono" contenteditable="true" spellcheck="false"></div>
</div>

<div class="row">
  <label><input type="checkbox" id="ignoreVariants"> 간체/번체 차이 무시</label>
</div>

<div class="row" style="position: relative;">
  <label><strong>비교 결과:</strong></label>
  <div id="output3" class="out box mono" style="font-size:1.2rem; line-height:1.8;"></div>
</div>

<script>
  /* === 공통 유틸 === */
  function escapeHTML(str){return str.replaceAll(/&/g,"&amp;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;");}
  function getEditableText(el){return (el.innerText||"").replace(/\u00A0/g,"");}
  function countHanja(text){try{const re=/\p{Script=Han}/gu;return (text.match(re)||[]).length;}catch{const re2=/[\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF]/g;return (text.match(re2)||[]).length;}}

  function diffByLCS(aArr,bArr){
    const n=aArr.length,m=bArr.length;
    const dp=Array.from({length:n+1},()=>Array(m+1).fill(0));
    for(let i=n-1;i>=0;i--){
      for(let j=m-1;j>=0;j--){
        dp[i][j]=(aArr[i]===bArr[j])?dp[i+1][j+1]+1:Math.max(dp[i+1][j],dp[i][j+1]);
      }
    }
    const ops=[];let i=0,j=0;
    while(i<n && j<m){
      if(aArr[i]===bArr[j]){pushOp('equal',aArr[i]);i++;j++;}
      else if(dp[i+1][j]>=dp[i][j+1]){pushOp('delete',aArr[i]);i++;}
      else {pushOp('insert',bArr[j]);j++;}
    }
    while(i<n){pushOp('delete',aArr[i]);i++;}
    while(j<m){pushOp('insert',bArr[j]);j++;}
    return {ops,lcs:dp[0][0]};
    function pushOp(type,ch){const last=ops[ops.length-1];if(last&&last.type===type)last.chars.push(ch);else ops.push({type,chars:[ch]});}
  }

  function renderHighlightedHTML(original,converted){
    const a=Array.from(original),b=Array.from(converted);
    const {ops}=diffByLCS(a,b);
    let inputHTML='',outputHTML='';
    for(const op of ops){
      if(op.type==='equal'){const s=escapeHTML(op.chars.join(''));inputHTML+=s;outputHTML+=s;}
      else if(op.type==='delete'){inputHTML+=`<span class="will-change">${escapeHTML(op.chars.join(''))}</span>`;}
      else if(op.type==='insert'){outputHTML+=`<span class="changed">${escapeHTML(op.chars.join(''))}</span>`;}
    }
    return {inputHTML,outputHTML};
  }

  /* === 1) 간/번체 변환 === */
  const modeSelect=document.getElementById('mode');
  const input1=document.getElementById('input1');
  const output1=document.getElementById('output1');
  const clear1=document.getElementById('clear1');
  const copy1=document.getElementById('copy1');
  const count1=document.getElementById('count1');
  let converter=null;

  function parseMode(m){const [from,to]=m.split('>');return{from,to};}
  function createConverter(){const {from,to}=parseMode(modeSelect.value);converter=OpenCC.Converter({from,to});}
  function updateSection1(){
    if(!converter)createConverter();
    const original=getEditableText(input1);
    let converted='';
    try{converted=converter(original);}catch(e){output1.innerHTML=`<span>[오류] ${escapeHTML(String(e))}</span>`;return;}
    const {inputHTML,outputHTML}=renderHighlightedHTML(original,converted);
    input1.innerHTML=inputHTML||'';output1.innerHTML=outputHTML||'';
    count1.textContent=`한자 개수(입력 기준): ${countHanja(original)}`;
  }
  modeSelect.addEventListener('change',()=>{createConverter();updateSection1();});
  let composing=false;
  input1.addEventListener('compositionstart',()=>composing=true);
  input1.addEventListener('compositionend',()=>{composing=false;updateSection1();});
  input1.addEventListener('input',()=>{if(!composing)updateSection1();});
  clear1.addEventListener('click',()=>{input1.innerHTML='';output1.innerHTML='';count1.textContent='';});
  copy1.addEventListener('click',async()=>{await navigator.clipboard.writeText(output1.innerText||'');});
  createConverter();

  /* === 2) 구두점 변환 === */
  const punctMap={"。":". ","，":", ","？":"? ","！":"! ","：":": ","；":"; ","（":"( ","）":") ","【":"[ ","】":"] ","“":'"',"”":'" ',"‘":"'","’":"' ","、":", ","∶":": "};
  function convertPunctuation(t){return t.replace(/[。，？！：；（）【】“”‘’、∶]/g,m=>punctMap[m]||m);}
  const input2=document.getElementById('input2'),output2=document.getElementById('output2'),clear2=document.getElementById('clear2'),copy2=document.getElementById('copy2'),count2=document.getElementById('count2');
  function updateSection2(){const text=input2.value||'';output2.value=convertPunctuation(text);count2.textContent=`한자 개수(입력 기준): ${countHanja(text)}`;}
  input2.addEventListener('input',updateSection2);
  clear2.addEventListener('click',()=>{input2.value='';output2.value='';count2.textContent='';});
  copy2.addEventListener('click',async()=>{await navigator.clipboard.writeText(output2.value||'');});

  /* === 3) 한문 배열 비교 === */
  const input3a=document.getElementById('input3a');
  const input3b=document.getElementById('input3b');
  const output3=document.getElementById('output3');
  const ignoreVariants=document.getElementById('ignoreVariants');
  const toCN=OpenCC.Converter({from:"t",to:"cn"});

  function extractHanja(text){
    try{return (text.match(/\p{Script=Han}/gu) || []);}
    catch{return (text.match(/[\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF]/g) || []);}
  }

  function compareHanjaArrays(aArr,bArr){
    const n=aArr.length,m=bArr.length;
    const dp=Array.from({length:n+1},()=>Array(m+1).fill(0));
    for(let i=n-1;i>=0;i--){
      for(let j=m-1;j>=0;j--){
        dp[i][j]=(aArr[i]===bArr[j])?dp[i+1][j+1]+1:Math.max(dp[i+1][j],dp[i][j+1]);
      }
    }
    const ops=[];let i=0,j=0;
    while(i<n && j<m){
      if(aArr[i]===bArr[j]){pushOp('equal',aArr[i]);i++;j++;}
      else if(dp[i+1][j]>=dp[i][j+1]){pushOp('delete',aArr[i]);i++;}
      else {pushOp('insert',bArr[j]);j++;}
    }
    while(i<n){pushOp('delete',aArr[i]);i++;}
    while(j<m){pushOp('insert',bArr[j]);j++;}
    return {ops,lcs:dp[0][0]};
    function pushOp(type,ch){const last=ops[ops.length-1];if(last&&last.type===type)last.chars.push(ch);else ops.push({type,chars:[ch]});}
  }

  function renderComparison(aText,bText){
    let aArr=extractHanja(aText), bArr=extractHanja(bText);
    if(ignoreVariants.checked){
      aArr=aArr.map(ch=>toCN(ch));
      bArr=bArr.map(ch=>toCN(ch));
    }
    const {ops,lcs}=compareHanjaArrays(aArr,bArr);

    let resA='',resB='';
    for(const op of ops){
      if(op.type==='equal'){const s=escapeHTML(op.chars.join(''));resA+=s;resB+=s;}
      else if(op.type==='delete'){resA+=`<span class="diff">${escapeHTML(op.chars.join(''))}</span>`;}
      else if(op.type==='insert'){resB+=`<span class="diff">${escapeHTML(op.chars.join(''))}</span>`;}
    }

    const totalA=aArr.length,totalB=bArr.length;
    const maxLen=Math.max(totalA,totalB)||1;
    const sameRatio=(lcs/maxLen*100).toFixed(1);
    const diffCount=(totalA+totalB)-(2*lcs);

    const stats=`<div class="stats">
      문장 A 한자 수: ${totalA} | 문장 B 한자 수: ${totalB}<br>
      동일률: ${sameRatio}% | 다른 글자 수: ${diffCount} | LCS 길이: ${lcs}
    </div>`;

    return {resA,resB,stats};
  }

  function updateSection3(){
    const a=input3a.innerText||'';
    const b=input3b.innerText||'';
    const {resA,resB,stats}=renderComparison(a,b);
    input3a.innerHTML=resA||''; // 입력창 A에 음영 반영
    input3b.innerHTML=resB||''; // 입력창 B에 음영 반영
    output3.innerHTML=`<div><strong>A:</strong> ${resA}</div><div><strong>B:</strong> ${resB}</div>${stats}`;
  }

  let composing=false;
  [input3a,input3b].forEach(el=>{
    el.addEventListener('compositionstart',()=>composing=true);
    el.addEventListener('compositionend',()=>{composing=false;updateSection3();});
    el.addEventListener('input',()=>{if(!composing)updateSection3();});
  });
 
